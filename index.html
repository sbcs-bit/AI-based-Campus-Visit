<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>University Voice Navigation Assistant</title>

<style>
:root{
    --primary:#2f80ed;
    --primary-dark:#1f6fe0;
    --bg:#eef2f7;
    --card:#ffffff;
    --text:#1f2937;
    --muted:#6b7280;
    --bot:#f3f4f6;
    --shadow: 0 10px 30px rgba(0,0,0,0.12);
    --radius:18px;
}

*{
    box-sizing:border-box;
}

body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: radial-gradient(circle at top, #f4f8ff, var(--bg));
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 18px;
    color: var(--text);
}

/* Chat container */
.chatbox {
    width: 520px;
    max-width: 96vw;
    height: 78vh;
    min-height: 520px;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(0,0,0,0.06);
}

/* Header */
.header {
    background: linear-gradient(135deg, var(--primary), #4aa3ff);
    color: white;
    padding: 16px 18px;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.2px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.header span{
    display:flex;
    align-items:center;
    gap:10px;
}

.badge{
    font-size: 12px;
    padding: 6px 10px;
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 999px;
}

/* Messages area */
.messages {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
    background: linear-gradient(#ffffff, #fbfcff);
}

.messages::-webkit-scrollbar{
    width: 10px;
}
.messages::-webkit-scrollbar-thumb{
    background: rgba(0,0,0,0.15);
    border-radius: 999px;
}
.messages::-webkit-scrollbar-track{
    background: transparent;
}

/* Message bubbles */
.msg {
    padding: 10px 14px;
    margin: 10px 0;
    border-radius: 14px;
    max-width: 86%;
    font-size: 14.5px;
    line-height: 1.45;
    position: relative;
    word-wrap: break-word;
    white-space: pre-wrap;
}

.user {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 6px;
    box-shadow: 0 10px 18px rgba(47,128,237,0.22);
}

.bot {
    background: var(--bot);
    color: var(--text);
    margin-right: auto;
    border-bottom-left-radius: 6px;
    border: 1px solid rgba(0,0,0,0.05);
}

/* Video player */
video {
    width: calc(100% - 24px);
    margin: 12px auto;
    display: none;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 10px 22px rgba(0,0,0,0.08);
}

/* Controls */
.controls {
    display: flex;
    gap: 10px;
    padding: 12px;
    border-top: 1px solid rgba(0,0,0,0.08);
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(8px);
}

.inputWrap{
    flex:1;
    display:flex;
    gap:10px;
    align-items:center;
    background:#f7f9ff;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 999px;
    padding: 8px 12px;
}

input {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    padding: 6px 6px;
    font-size: 14.5px;
    color: var(--text);
}

input::placeholder{
    color: #8b93a1;
}

button {
    border: none;
    cursor: pointer;
    font-weight: 700;
    font-size: 14px;
    border-radius: 999px;
    transition: transform 0.12s ease, background 0.2s ease, opacity 0.2s ease;
}

.btnSend{
    padding: 10px 14px;
    background: var(--primary);
    color: white;
    box-shadow: 0 10px 18px rgba(47,128,237,0.20);
}
.btnSend:hover{
    background: var(--primary-dark);
    transform: translateY(-1px);
}

.btnMic{
    width: 46px;
    height: 46px;
    background: #111827;
    color: white;
}
.btnMic:hover{
    opacity: 0.9;
    transform: translateY(-1px);
}

/* Small helper footer */
.hint{
    font-size: 12px;
    color: var(--muted);
    padding: 0 16px 12px 16px;
    background: linear-gradient(#fbfcff, #ffffff);
}
</style>
</head>

<body>

<div class="chatbox">
    <div class="header">
        <span>AI-based Campus Visit</span>
        <div class="badge">Voice + Chat</div>
    </div>

    <div class="messages" id="messages"></div>

    <video id="videoPlayer" controls></video>

    <div class="hint">Tip: Try ‚Äúbuilding 5‚Äù, ‚Äúbuilding six‚Äù, or ‚ÄúCSE department‚Äù.</div>

    <div class="controls">
        <div class="inputWrap">
            <input id="textInput" placeholder="Ask a question or say building / department..." />
        </div>
        <button class="btnSend" onclick="sendText()">Send</button>
        <button class="btnMic" onclick="startListening()">üé§</button>
    </div>
</div>

<script>
const messages = document.getElementById("messages");
const videoPlayer = document.getElementById("videoPlayer");

/* ---------------- Speech Recognition ---------------- */
let recognition;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = "en-US";

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        addMessage(text, "user");
        processCommand(text);
    };

    recognition.onerror = () => {
        addMessage("Microphone error or permission denied.", "bot");
        speak("Microphone error or permission denied.");
    };
}

/* ---------------- Text to Speech ---------------- */
function speak(text) {
    speechSynthesis.cancel();
    speechSynthesis.speak(new SpeechSynthesisUtterance(text));
}

/* ---------------- UI Helpers ---------------- */
function addMessage(text, sender) {
    const div = document.createElement("div");
    div.className = "msg " + sender;
    div.innerText = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function sendText() {
    const input = document.getElementById("textInput");
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "user");
    input.value = "";
    processCommand(text);
}

/* ‚úÖ ENTER KEY SUPPORT */
document.getElementById("textInput").addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
        event.preventDefault();
        sendText();
    }
});

function startListening() {
    addMessage("Listening...", "bot");
    if (!recognition) {
        addMessage("Speech recognition not supported in this browser.", "bot");
        speak("Speech recognition not supported in this browser.");
        return;
    }
    recognition.start();
}

/* ---------------- Video ---------------- */
function playVideo(file) {
    videoPlayer.src = file;
    videoPlayer.style.display = "block";
    videoPlayer.playbackRate = 2;
    videoPlayer.play();
}

/* ---------------- Knowledge Base ---------------- */
const knowledgeBase = [
    { k:["cyber science"], a:"Cyber Science and Technology is in Satyajit Bhavan, Building 1. Rooms 109 Head of the Department and 110." },
    { k:["english"], a:"English and Literary Studies is in Satyajit Bhavan, Building 1, Room 104." },
    { k:["media", "journalism"], a:"Media Science and Journalism is in Satyajit Bhavan, Building 1, Room 409." },
    { k:["multimedia"], a:"Multimedia department is in Satyajit Bhavan, Building 1, Room 301." },
    { k:["psychology"], a:"Psychology department is in Satyajit Bhavan, Building 1, Room 101." },

    { k:["pharmaceutical", "pharmacy"], a:"Pharmaceutical Technology is in Prafulla Bhavan, Building 3. Rooms 109 Head of the Department and 107." },

    { k:["agriculture"], a:"Agriculture department is in Jagadish Bhavan, Building 4. Rooms 102 Head of the Department and 101." },
    { k:["allied health"], a:"Allied Health Sciences is in Jagadish Bhavan, Building 4. Rooms 207 Head of the Department, 202, 301 and 302." },
    { k:["biotechnology"], a:"Biotechnology department is in Jagadish Bhavan, Building 4, Room 106." },
    { k:["chemistry"], a:"Chemistry department is in Jagadish Bhavan, Building 4, Room 224." },
    { k:["civil"], a:"Civil Engineering is in Jagadish Bhavan, Building 4, Room 004." },
    { k:["electrical"], a:"Electrical Engineering is in Jagadish Bhavan, Building 4, Room 120." },
    { k:["electronics", "ece"], a:"Electronics and Communication Engineering is in Jagadish Bhavan, Building 4, Room 128." },
    { k:["food", "nutrition"], a:"Food and Nutrition department is in Jagadish Bhavan, Building 4, Room 119." },
    { k:["mathematics"], a:"Mathematics department is in Jagadish Bhavan, Building 4. Rooms 328 Head of the Department and 329." },
    { k:["mechanical"], a:"Mechanical Engineering is in Jagadish Bhavan, Building 4, Room 004." },
    { k:["physics"], a:"Physics department is in Jagadish Bhavan, Building 4, Room 225." },

    { k:["computer science", "cse"], a:"Computer Science and Engineering is in Rabindra Bhavan, Building 5. Rooms 105 Head of the Department and 003." },
    { k:["ai"], a:"CSE with Artificial Intelligence is in Rabindra Bhavan, Building 5. Rooms 103 Head of the Department and 104." },
    { k:["data science", "ds"], a:"CSE with Data Science is in Rabindra Bhavan, Building 5, Room 203." },

    { k:["commerce"], a:"Commerce department is in Rammohan Bhavan, Building 6. Rooms 613 Head of the Department and 616." },
    { k:["computational"], a:"Computational Sciences is in Rammohan Bhavan, Building 6. Rooms 306 Head of the Department Dr. Jayanta Aich, 303 and 305." },
    { k:["css"], a:"Computational Sciences is in Rammohan Bhavan, Building 6. Rooms 306 Head of the Department Dr. Jayanta Aich, 303 and 305." },
    { k:["hospital"], a:"Hospital Management is in Rammohan Bhavan, Building 6, Room 701." },
    { k:["law"], a:"Law department is in Rammohan Bhavan, Building 6. Rooms 105 Head of the Department and 106." },
    { k:["management"], a:"Management department is in Rammohan Bhavan, Building 6. Rooms 505 Head of the Department and 503." },

    { k:["nursing"], a:"Institute of Nursing is in Vivekananda Bhavan, Building 9. Rooms 008 Principal, 009 and 010." }
];

/* ---------------- Number Word Normalization ---------------- */
const wordToNumber = {
    one: "1",
    two: "2",
    three: "3",
    four: "4",
    five: "5",
    six: "6",
    seven: "7",
    eight: "8",
    nine: "9"
};

function normalizeInput(text) {
    return text.toLowerCase().replace(
        /\b(one|two|three|four|five|six|seven|eight|nine)\b/g,
        match => wordToNumber[match]
    );
}

/* ---------------- Main Logic ---------------- */
function processCommand(text) {
    const input = normalizeInput(text);
    const bMatch = input.match(/\bbuilding\s*([1-9])\b|\b([1-9])\b/);

    if (bMatch) {
        const b = bMatch[1] || bMatch[2];
        const reply = `Showing directions to Building ${b}.`;
        playVideo(`${b}.mp4`);
        addMessage(reply, "bot");
        speak(reply);
        return;
    }

    for (const item of knowledgeBase) {
        if (item.k.some(key => input.includes(key))) {
            addMessage(item.a, "bot");
            speak(item.a);
            return;
        }
    }

    const fallback = "I can help with department locations, room numbers, and building navigation.";
    addMessage(fallback, "bot");
    speak(fallback);
}
</script>

</body>
</html>
